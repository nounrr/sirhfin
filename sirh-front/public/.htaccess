# Configuration Apache pour SMART RH PWA

# Activer la compression
<IfModule mod_deflate.c>
    # Compresser les fichiers texte
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
    AddOutputFilterByType DEFLATE application/json
</IfModule>

# Headers de sécurité
<IfModule mod_headers.c>
    # Headers PWA
    <FilesMatch "manifest\.json$">
        Header set Content-Type "application/manifest+json"
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>
    
    # Service Worker - Pas de cache
    <FilesMatch "sw\.js$">
        Header set Content-Type "application/javascript"
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </FilesMatch>
    
    # Fichier de version - Pas de cache
    <Files "version.json">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </Files>
    
    # CSS et JS - Cache long terme avec hash
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </FilesMatch>
    
    # Images - Cache long terme
    <FilesMatch "\.(png|jpg|jpeg|gif|ico|svg|webp)$">
        Header set Cache-Control "public, max-age=31536000"
    </FilesMatch>
    
    # Fonts - Cache long terme
    <FilesMatch "\.(woff|woff2|ttf|eot)$">
        Header set Cache-Control "public, max-age=31536000"
        Header set Access-Control-Allow-Origin "*"
    </FilesMatch>
</IfModule>

# Types MIME
<IfModule mod_mime.c>
    AddType application/javascript .js
    AddType text/css .css
    AddType application/manifest+json .webmanifest
    AddType application/x-web-app-manifest+json .webapp
    AddType text/cache-manifest .appcache
</IfModule>

# Réécriture d'URL pour SPA (Single Page Application)
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Empêcher l'accès direct aux fichiers sensibles
    RewriteRule ^\.env$ - [F,L]
    
    # Gérer les chemins d'assets
    RewriteRule ^assets/(.*)$ assets/$1 [L]
    
    # Rediriger toutes les autres requêtes vers index.html (sauf les fichiers existants)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/assets/
    RewriteRule ^(.*)$ index.html [QSA,L]
</IfModule>

# Configuration des erreurs
ErrorDocument 404 /index.html

# Options du serveur
Options -Indexes +FollowSymLinks

# Protection contre les hotlinks d'images
<IfModule mod_rewrite.c>
    RewriteCond %{HTTP_REFERER} !^$
    RewriteCond %{HTTP_REFERER} !^https?://(www\.)?votre-domaine\.com [NC]
    RewriteRule \.(jpg|jpeg|png|gif|svg)$ - [F]
</IfModule>
